# ============================================================================
# CONFIGURACIÓN DE QA - CITA CLICK
# ============================================================================
# Activar con: SPRING_PROFILES_ACTIVE=qa
# Desplegado en DO App Platform (QA) apuntando a schema ccdiaq
# ============================================================================

spring:
  application:
    name: citaclick-api-qa

  # ============================================================================
  # BASE DE DATOS - Mismo servidor DO, schema de QA
  # Schema: ccdiaq (cita-click-qa)
  # ============================================================================
  datasource:
    url: ${DATABASE_URL}
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      pool-name: CitaClickQAPool
      maximum-pool-size: 5
      minimum-idle: 1
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # ============================================================================
  # JPA / HIBERNATE
  # ============================================================================
  jpa:
    hibernate:
      # update: primer deploy con schema vacío
      # validate: después de que las tablas ya existan
      ddl-auto: ${DDL_AUTO:update}
    show-sql: false
    properties:
      hibernate:
        default_schema: ${DB_SCHEMA:ccdiaq}
        format_sql: false
        jdbc:
          time_zone: America/Mexico_City
    open-in-view: false

# ============================================================================
# SERVER
# ============================================================================
server:
  port: ${PORT:8080}
  servlet:
    context-path: /api
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain

# ============================================================================
# LOGGING - Más verboso que prod para detectar errores en QA
# ============================================================================
logging:
  level:
    root: WARN
    com.reservas: DEBUG
    org.springframework.web: INFO
    org.springframework.security: INFO
    org.hibernate.SQL: WARN

# ============================================================================
# JWT
# ============================================================================
jwt:
  secret: ${JWT_SECRET}
  expiration: 604800000
  refresh-expiration: 2592000000

# ============================================================================
# GOOGLE OAUTH2
# ============================================================================
google:
  client:
    id: ${GOOGLE_CLIENT_ID}

# ============================================================================
# STRIPE - Usar SIEMPRE claves TEST en QA (sk_test_... / pk_test_...)
# ============================================================================
stripe:
  secret:
    key: ${STRIPE_SECRET_KEY}
  api:
    key: ${STRIPE_API_KEY}
  webhook:
    secret: ${STRIPE_WEBHOOK_SECRET}
  success:
    url: ${FRONTEND_URL}/payment/success
  cancel:
    url: ${FRONTEND_URL}/payment/cancel
  price:
    basico: ${STRIPE_PRICE_BASICO}
    profesional: ${STRIPE_PRICE_PROFESIONAL}
    premium: ${STRIPE_PRICE_PREMIUM}

# ============================================================================
# RESEND - Email
# ============================================================================
resend:
  api:
    key: ${RESEND_API_KEY}
  from:
    email: ${RESEND_FROM_EMAIL:qa@citaclick.com.mx}
    name: ${RESEND_FROM_NAME:Cita Click QA}
  templates:
    verificacion-correo:      ${RESEND_TEMPLATE_VERIFICACION:verificacin-correo-electrnico}
    recordatorio-clasico:     ${RESEND_TEMPLATE_RECORDATORIO_CLASICO:recordatorio-clasico}
    recordatorio-moderno:     ${RESEND_TEMPLATE_RECORDATORIO_MODERNO:recordatorio-moderno}
    recordatorio-minimalista: ${RESEND_TEMPLATE_RECORDATORIO_MINIMALISTA:recordatorio-minimalista}

# ============================================================================
# GCP
# ============================================================================
gcp:
  project:
    id: ${GCP_PROJECT_ID:}
  bucket:
    name: ${GCP_BUCKET_NAME:}

# ============================================================================
# TWILIO - Deshabilitado en QA
# ============================================================================
twilio:
  account:
    sid: ${TWILIO_ACCOUNT_SID:}
  auth:
    token: ${TWILIO_AUTH_TOKEN:}
  phone:
    number: ${TWILIO_PHONE_NUMBER:}
  whatsapp:
    from: ${TWILIO_WHATSAPP_NUMBER:}
    number: ${TWILIO_WHATSAPP_NUMBER:}

# ============================================================================
# RATE LIMITING - Habilitado en QA (igual que prod)
# ============================================================================
rate:
  limit:
    enabled: ${RATE_LIMIT_ENABLED:true}

# ============================================================================
# FRONTEND URL
# ============================================================================
frontend:
  url: ${FRONTEND_URL}

app:
  frontend:
    url: ${FRONTEND_URL}
    extra-origins: ${FRONTEND_EXTRA_ORIGINS:}
  cookie:
    secure: true      # HTTPS en DO App Platform
    same-site: None   # Cross-site entre subdominios ondigitalocean.app (PSL)

# ============================================================================
# SWAGGER / SPRINGDOC - Habilitado en QA para facilitar pruebas
# URL: https://<qa-backend-url>/api/swagger-ui.html
# ============================================================================
springdoc:
  api-docs:
    enabled: true
  swagger-ui:
    enabled: true
    path: /swagger-ui.html

# ============================================================================
# ACTUATOR
# ============================================================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
  health:
    db:
      enabled: true
