# ============================================================================
# CONFIGURACIÓN DE PRODUCCIÓN - CITA CLICK
# ============================================================================
# Este archivo se activa con: SPRING_PROFILES_ACTIVE=prod
# Variables se inyectan desde variables de entorno del servidor

spring:
  application:
    name: citaclick-api-prod

  # ============================================================================
  # DATABASE - PostgreSQL en Producción
  # ============================================================================
  datasource:
    url: ${DATABASE_URL}
    username: ${DB_USER}
    password: ${DB_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      pool-name: CitaClickProdPool
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000   # 30s para obtener conexión del pool
      idle-timeout: 600000        # 10 min antes de cerrar conexión inactiva
      max-lifetime: 1800000       # 30 min vida máxima de una conexión

  # ============================================================================
  # JPA - PRODUCCIÓN
  # ============================================================================
  # DDL_AUTO controla cómo Hibernate gestiona el schema en la BD:
  #   validate  → Solo valida que las tablas existen (default en prod - RECOMENDADO)
  #   update    → Crea/modifica tablas automáticamente (usar en el PRIMER deploy con BD vacía)
  #   create    → Destruye y recrea todo (NUNCA usar con datos reales)
  #
  # ⚠️ PRIMER DEPLOY con base de datos vacía:
  #   Lanza con: DDL_AUTO=update  → Hibernate crea todas las tablas
  #   Luego cambia a: DDL_AUTO=validate (o elimina la variable para usar el default)
  jpa:
    hibernate:
      ddl-auto: ${DDL_AUTO:validate}
    show-sql: false
    properties:
      hibernate:
        default_schema: ccdiad
        format_sql: false
        jdbc:
          time_zone: America/Mexico_City
    open-in-view: false

# ============================================================================
# SERVER
# ============================================================================
server:
  port: ${PORT:8080}
  servlet:
    context-path: /api
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain

# ============================================================================
# LOGGING - Producción
# El formato se define en logback-spring.xml (perfil prod).
# ============================================================================
logging:
  level:
    root: WARN
    com.reservas: INFO
    org.springframework.web: WARN
    org.springframework.security: WARN
    org.hibernate: WARN

# ============================================================================
# JWT
# ============================================================================
jwt:
  secret: ${JWT_SECRET}  # OBLIGATORIO: Generar con openssl rand -base64 64
  expiration: 604800000  # 7 días
  refresh-expiration: 2592000000  # 30 días

# ============================================================================
# GOOGLE OAUTH2
# ============================================================================
google:
  client:
    id: ${GOOGLE_CLIENT_ID}

# ============================================================================
# STRIPE - PRODUCCIÓN
# ============================================================================
stripe:
  secret:
    key: ${STRIPE_SECRET_KEY}  # sk_live_... en producción

  api:
    key: ${STRIPE_API_KEY}  # pk_live_... en producción

  webhook:
    secret: ${STRIPE_WEBHOOK_SECRET}  # whsec_... del webhook en producción

  success:
    url: ${FRONTEND_URL}/payment/success

  cancel:
    url: ${FRONTEND_URL}/payment/cancel

  price:
    basico: ${STRIPE_PRICE_BASICO}
    profesional: ${STRIPE_PRICE_PROFESIONAL}
    premium: ${STRIPE_PRICE_PREMIUM}

# ============================================================================
# TWILIO - SMS/WhatsApp (DESHABILITADO POR AHORA)
# ============================================================================
twilio:
  account:
    sid: ${TWILIO_ACCOUNT_SID:}  # Vacío = deshabilitado
  auth:
    token: ${TWILIO_AUTH_TOKEN:}
  phone:
    number: ${TWILIO_PHONE_NUMBER:}
  whatsapp:
    number: ${TWILIO_WHATSAPP_NUMBER:}

# ============================================================================
# RESEND - Email (PRIORIDAD)
# ============================================================================
resend:
  api:
    key: ${RESEND_API_KEY}  # OBLIGATORIO - obtener en https://resend.com
  from:
    email: ${RESEND_FROM_EMAIL:noreply@citaclick.com.mx}
    name: ${RESEND_FROM_NAME:Cita Click}

  # IDs de referencia de los templates en Resend Dashboard (solo documentación).
  # El servicio carga los HTML desde src/main/resources/email-templates/ y los envía con el campo "html".
  templates:
    verificacion-correo:      ${RESEND_TEMPLATE_VERIFICACION:verificacin-correo-electrnico}
    recordatorio-clasico:     ${RESEND_TEMPLATE_RECORDATORIO_CLASICO:recordatorio-clasico}
    recordatorio-moderno:     ${RESEND_TEMPLATE_RECORDATORIO_MODERNO:recordatorio-moderno}
    recordatorio-minimalista: ${RESEND_TEMPLATE_RECORDATORIO_MINIMALISTA:recordatorio-minimalista}

# ============================================================================
# GOOGLE CLOUD STORAGE
# ============================================================================
gcp:
  project:
    id: ${GCP_PROJECT_ID:}
  bucket:
    name: ${GCP_BUCKET_NAME:}

# ============================================================================
# RATE LIMITING
# ============================================================================
rate:
  limit:
    enabled: true

# ============================================================================
# FRONTEND URL
# ============================================================================
frontend:
  url: ${FRONTEND_URL:https://citaclick.com.mx}

app:
  frontend:
    url: ${FRONTEND_URL:https://citaclick.com.mx}
    # Orígenes extra de CORS separados por coma.
    # Agrega aquí todos los dominios desde los que el frontend hace peticiones al API.
    # Ejemplo: https://citaclick.com.mx,https://www.citaclick.com.mx,https://app.citaclick.com.mx
    extra-origins: ${FRONTEND_EXTRA_ORIGINS:https://www.citaclick.com.mx,https://app.citaclick.com.mx}
  cookie:
    secure: true  # HTTPS en producción

# ============================================================================
# SPRINGDOC / SWAGGER - Deshabilitado en producción
# ============================================================================
springdoc:
  api-docs:
    enabled: false
  swagger-ui:
    enabled: false

# ============================================================================
# ACTUATOR
# ============================================================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always
  health:
    db:
      enabled: true
